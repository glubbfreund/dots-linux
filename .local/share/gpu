#!/bin/bash
# /usr/local/bin/gpu

gpumode=$(/home/oli/.local/bin/gpumonitor)

case $1 in
    "opt")
	[ "$gpumode" != "OPT" ] &&
	    yad --title="MUX-Steuerung" --text="\n Zu Optimus umschalten und neu starten? \n" &&
	    rog-mux -s optimus &&
	    { [ -e /etc/udev/rules.d/00-remove-nvidia.disabled ] || \
		  sudo mv /etc/udev/rules.d/00-remove-nvidia.rules /etc/udev/rules.d/00-remove-nvidia.disabled; } &&
	    xfce4-session-logout --reboot
	;;
    "int")
	[ "$gpumode" != "INT" ] &&
	    yad --title="MUX-Steuerung" --text="\n Zu Interner GPU umschalten und neu starten? \n" &&
            rog-mux -s optimus &&
	    { [ -e /etc/udev/rules.d/00-remove-nvidia.rules ] || \
		  sudo mv /etc/udev/rules.d/00-remove-nvidia.disabled /etc/udev/rules.d/00-remove-nvidia.rules; } &&
	    xfce4-session-logout --reboot
	;;
    "ult")
	[ "$gpumode" != "ULT" ] &&
	    yad --title="MUX-Steuerung" --text="\n Zu Ultimate umschalten und neu starten? \n" &&
	    rog-mux -s ultimate &&
	    { [ -e /etc/udev/rules.d/00-remove-nvidia.disabled ] || \
		  sudo mv /etc/udev/rules.d/00-remove-nvidia.rules /etc/udev/rules.d/00-remove-nvidia.disabled; } &&
	    xfce4-session-logout --reboot
	;;
    *)
	echo "Parameters to choose are opt|ult|int"
	;;
esac
