#!/bin/bash
# ~/.local/bin/xbps-srcu

curDir=$(pwd)
verbose=false

if [[ "$1" == "-v" ]]; then
    verbose=true
    shift
fi

run_step() {
    local msg="$1"
    shift
    echo -ne "[ ] $msg ...\r"
    if $verbose; then
        "$@"
    else
        "$@" > /dev/null 2>&1
    fi
    if [ $? -eq 0 ]; then
        echo -e "[*] $msg ..."
    else
        echo -e "[!] $msg ..."
	echo "Aborting ..."
	exit 1
    fi
}

 run_step "Fetching repository updates" bash -c '
    cd ~/Dokumente/Src/void-packages &&
    git pull &&
    cd srcpkgs/brave-bin && git pull
'

run_step "Updating xbps packages" bash -c '
    cd ~/Dokumente/Src/void-packages &&
    ./xbps-src pkg brave-bin spotify
'

run_step "Cleaning up" bash -c '
    cd ~/Dokumente/Src/void-packages &&
    ./xbps-src clean
'

cd "$curDir"
